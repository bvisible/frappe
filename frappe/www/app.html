<!DOCTYPE html>
<html data-theme-mode="{{ desk_theme.lower() }}" data-theme="{{ desk_theme.lower() }}" dir={{ layout_direction }} lang="{{ lang }}">
	<head>
		<!-- Chrome, Firefox OS and Opera -->
		<meta name="theme-color" content="#0089FF">
		<!-- Windows Phone -->
		<meta name="msapplication-navbutton-color" content="#0089FF">
		<!-- iOS Safari -->
		<meta name="apple-mobile-web-app-status-bar-style" content="#0089FF">
		<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
		<meta content="utf-8" http-equiv="encoding">
		<meta name="author" content="">
		<meta name="viewport" content="width=device-width, initial-scale=1.0,
			maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, minimal-ui">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="white">
		<meta name="mobile-web-app-capable" content="yes">
		<!-- //// -->
		<title>Neoffice Gestion</title>
		<script src="https://support.neoffice.io/js/min/jquery.min.js"></script>
		<script id="sbinit" src="https://support.neoffice.io/js/main.js"></script>
		<script>
			jQuery(document).on("SBReady", function () {
				SBF.getActiveUser(true, () => {
					setTimeout(() => {
						let neo_user_email = user_email;
						if (!SBF.activeUser() || (SBF.activeUser().email != neo_user_email)) {
							function isEmpty(value){
								return (typeof value === "undefined" || value === null || value === '' || value === ' ');
							}
							let first_name = user_fullname.substring(0, user_fullname.indexOf(' '));
							let last_name = user_fullname.substring(user_fullname.indexOf(' ') + 1);
							if(isEmpty(first_name)){
								first_name = neo_user_email.substring(0, neo_user_email.indexOf('@'));
							}
							if(isEmpty(last_name)){
								last_name = neo_user_email.substring(0, neo_user_email.indexOf('@'));
							}
							SBF.ajax({
								function: "add-user-and-login",
								settings: { profile_image: "https://board.support/media/docs/user.png", first_name: first_name, last_name: last_name, email: neo_user_email, password: window.localStorage.getItem('metadata_version') },
								settings_extra: { company: [frappe.defaults.get_user_default("company"), "company"], instance: [window.location.hostname, "Instance"]}
							}, (response) => {
								if (!SBF.errorValidation(response)) {
									SBF.loginCookie(response[1]);
									SBF.activeUser(new SBUser(response[0]));
									SBChat.initChat();
								} else if (response[1] == "duplicate-email") {
									SBF.login(neo_user_email, window.localStorage.getItem('metadata_version'), "", "", () => { SBChat.initChat(); });
								} else console.log(response);
							});
						} else {
							SBChat.initChat();
						}
					}, 500);
				});
			});
		</script>
		<!-- //// -->
		<link rel="shortcut icon"
			href="{{ favicon or "/assets/frappe/images/frappe-favicon.svg" }}" type="image/x-icon">
		<link rel="icon"
			href="{{ favicon or "/assets/frappe/images/frappe-favicon.svg" }}" type="image/x-icon">
		{% for include in include_css -%}
		{{ include_style(include) }}
		{%- endfor -%}
	</head>
	<body>
		{% include "public/icons/timeless/icons.svg" %}
		{% include "templates/includes/splash_screen.html" %}
		<div class="main-section">
			<header></header>
			<!-- //// -->
			<div id="app-access">
				<h4 class="title-quick-access"></h4>
				<ul class="navbar-nav-speed">
				</ul>
			</div>
			<!-- //// -->
			<div id="body"></div>
			<footer></footer>
		</div>
		<div id="build-events-overlay"></div>

		<script type="text/javascript">
			window._version_number = "{{ build_version }}";
			// browser support
			window.app = true;
			window.dev_server = {{ dev_server }};

			if (!window.frappe) window.frappe = {};

			frappe.boot = JSON.parse({{ boot }});
			frappe._messages = frappe.boot["__messages"];
			frappe.csrf_token = "{{ csrf_token }}";
		</script>

	{% for include in include_js %}
	{{ include_script(include) }}
	{% endfor %}

	{% include "templates/includes/app_analytics/google_analytics.html" %}
	{% include "templates/includes/app_analytics/mixpanel_analytics.html" %}

		{% for sound in (sounds or []) %}
		<audio preload="auto" id="sound-{{ sound.name }}" volume={{ sound.volume or 1 }}>
			<source src="{{ sound.src }}"></source>
		</audio>
		{% endfor %}
	</body>
</html>
